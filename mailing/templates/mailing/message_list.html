<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–°–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π</title>
    <style>
        body { font-family: Arial; max-width: 1000px; margin: 40px auto; padding: 20px; }
        .header { display: flex; justify-content: space-between; align-items: center; }
        .btn { padding: 10px 15px; background: #4CAF50; color: white; text-decoration: none; border-radius: 4px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #f2f2f2; }
        tr:hover { background-color: #f5f5f5; }
        .actions a { margin-right: 10px; color: #2196F3; }
        .message-preview { max-width: 300px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .owner-info { font-size: 0.9em; color: #666; margin-top: 5px; }
        .manager-badge { background: #ff9800; color: white; padding: 2px 6px; border-radius: 3px; font-size: 0.8em; margin-left: 5px; }
        .access-badge { background: #e0e0e0; padding: 2px 8px; border-radius: 10px; font-size: 0.8em; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üì® –°–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π</h1>
        <a href="{% url 'message_create' %}" class="btn">‚ûï –°–æ–∑–¥–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</a>
    </div>

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–∞–≤–∞—Ö -->
    <div style="margin: 10px 0; padding: 10px; background: #f0f8ff; border-radius: 4px; font-size: 0.9em;">
        {% if user.groups.all.0.name == '–ú–µ–Ω–µ–¥–∂–µ—Ä—ã' or user.is_superuser %}
            <span class="manager-badge">‚ö° –ú–µ–Ω–µ–¥–∂–µ—Ä</span> –í—ã –≤–∏–¥–∏—Ç–µ –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
        {% else %}
            –í—ã –≤–∏–¥–∏—Ç–µ —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
        {% endif %}
    </div>

    <table>
        <thead>
            <tr>
                <th>–¢–µ–º–∞ –ø–∏—Å—å–º–∞</th>
                <th>–¢–µ–∫—Å—Ç –ø–∏—Å—å–º–∞ (–ø—Ä–µ–≤—å—é)</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
        </thead>
        <tbody>
            {% for message in messages %}
            <tr>
                <td>
                    <strong>{{ message.subject }}</strong>
                    <div class="owner-info">
                        {% if message.owner == user %}
                            <span class="access-badge">–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</span>
                        {% elif user.groups.all.0.name == '–ú–µ–Ω–µ–¥–∂–µ—Ä—ã' or user.is_superuser %}
                            –í–ª–∞–¥–µ–ª–µ—Ü: {{ message.owner.username }}
                        {% endif %}
                    </div>
                </td>
                <td class="message-preview">{{ message.body|truncatechars:100 }}</td>
                <td class="actions">
                    <a href="{% url 'message_detail' message.pk %}">üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä</a>

                    <!-- –ü–†–û–í–ï–†–ö–ê –ü–†–ê–í: —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –∏–ª–∏ –º–µ–Ω–µ–¥–∂–µ—Ä –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å/—É–¥–∞–ª—è—Ç—å -->
                    {% if message.owner == user or user.groups.all.0.name == '–ú–µ–Ω–µ–¥–∂–µ—Ä—ã' or user.is_superuser %}
                        <a href="{% url 'message_update' message.pk %}">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                        <a href="{% url 'message_delete' message.pk %}" style="color: #f44336;">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</a>
                    {% else %}
                        <span style="color: #999; font-size: 0.9em;">–¢–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä</span>
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="3" style="text-align: center;">–°–æ–æ–±—â–µ–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div style="margin-top: 20px;">
        <a href="{% url 'home' %}">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a> |
        <a href="{% url 'client_list' %}">üìã –ö —Å–ø–∏—Å–∫—É –∫–ª–∏–µ–Ω—Ç–æ–≤</a>
    </div>
</body>
</html>