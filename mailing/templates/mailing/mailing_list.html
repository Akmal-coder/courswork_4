<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–°–ø–∏—Å–æ–∫ —Ä–∞—Å—Å—ã–ª–æ–∫</title>
    <style>
        body { font-family: Arial; max-width: 1200px; margin: 40px auto; padding: 20px; }
        .header { display: flex; justify-content: space-between; align-items: center; }
        .btn { padding: 10px 15px; background: #4CAF50; color: white; text-decoration: none; border-radius: 4px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #f2f2f2; }
        tr:hover { background-color: #f5f5f5; }
        .actions a { margin-right: 10px; color: #2196F3; }
        .status-active { color: #4CAF50; font-weight: bold; }
        .status-inactive { color: #f44336; }
        .status-completed { color: #2196F3; }
        .owner-info { font-size: 0.9em; color: #666; margin-top: 5px; }
        .manager-badge { background: #ff9800; color: white; padding: 2px 6px; border-radius: 3px; font-size: 0.8em; margin-left: 5px; }
        .access-badge { background: #e0e0e0; padding: 2px 8px; border-radius: 10px; font-size: 0.8em; }
        .client-count { font-weight: bold; color: #2196F3; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìß –°–ø–∏—Å–æ–∫ —Ä–∞—Å—Å—ã–ª–æ–∫</h1>
        <a href="{% url 'mailing_create' %}" class="btn">‚ûï –°–æ–∑–¥–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É</a>
    </div>

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–∞–≤–∞—Ö -->
    <div style="margin: 10px 0; padding: 10px; background: #f0f8ff; border-radius: 4px; font-size: 0.9em;">
        {% if user.groups.all.0.name == '–ú–µ–Ω–µ–¥–∂–µ—Ä—ã' or user.is_superuser %}
            <span class="manager-badge">‚ö° –ú–µ–Ω–µ–¥–∂–µ—Ä</span> –í—ã –≤–∏–¥–∏—Ç–µ –≤—Å–µ —Ä–∞—Å—Å—ã–ª–∫–∏ —Å–∏—Å—Ç–µ–º—ã
        {% else %}
            –í—ã –≤–∏–¥–∏—Ç–µ —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —Ä–∞—Å—Å—ã–ª–∫–∏
        {% endif %}
        <div style="margin-top: 5px; font-size: 0.85em;">
            üìä –í—Å–µ–≥–æ —Ä–∞—Å—Å—ã–ª–æ–∫: {{ mailings|length }}
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                <th>–°–æ–æ–±—â–µ–Ω–∏–µ</th>
                <th>–ö–ª–∏–µ–Ω—Ç—ã</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
        </thead>
        <tbody>
            {% for mailing in mailings %}
            <tr>
                <td>
                    <strong>{{ mailing.name }}</strong>
                    <div class="owner-info">
                        {% if mailing.owner == user %}
                            <span class="access-badge">–í–∞—à–∞ —Ä–∞—Å—Å—ã–ª–∫–∞</span>
                        {% elif user.groups.all.0.name == '–ú–µ–Ω–µ–¥–∂–µ—Ä—ã' or user.is_superuser %}
                            –í–ª–∞–¥–µ–ª–µ—Ü: {{ mailing.owner.username }}
                        {% endif %}
                    </div>
                </td>
                <td>
                    {{ mailing.message.subject }}
                    <div class="owner-info" style="font-size: 0.85em;">
                        {% if mailing.message.owner == user %}
                            <em>–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</em>
                        {% elif mailing.message.owner != mailing.owner %}
                            –°–æ–æ–±—â–µ–Ω–∏–µ: {{ mailing.message.owner.username }}
                        {% endif %}
                    </div>
                </td>
                <td>
                    <span class="client-count">{{ mailing.clients.count }}</span> –∫–ª–∏–µ–Ω—Ç–æ–≤
                    <div class="owner-info" style="font-size: 0.85em;">
                        {% if mailing.clients.all.0.owner != user %}
                            <em>–∫–ª–∏–µ–Ω—Ç—ã –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</em>
                        {% endif %}
                    </div>
                </td>
                <td>
                    {% if mailing.status == 'created' %}
                        <span class="status-inactive">–°–æ–∑–¥–∞–Ω–∞</span>
                    {% elif mailing.status == 'started' %}
                        <span class="status-active">–ó–∞–ø—É—â–µ–Ω–∞</span>
                    {% elif mailing.status == 'completed' %}
                        <span class="status-completed">–ó–∞–≤–µ—Ä—à–µ–Ω–∞</span>
                    {% endif %}
                </td>
                <td>{{ mailing.get_frequency_display }}</td>
                <td class="actions">
                    <a href="{% url 'mailing_detail' mailing.pk %}">üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä</a>

                    <!-- –ü–†–û–í–ï–†–ö–ê –ü–†–ê–í: —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –∏–ª–∏ –º–µ–Ω–µ–¥–∂–µ—Ä –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å/—É–¥–∞–ª—è—Ç—å -->
                    {% if mailing.owner == user or user.groups.all.0.name == '–ú–µ–Ω–µ–¥–∂–µ—Ä—ã' or user.is_superuser %}
                        <a href="{% url 'mailing_update' mailing.pk %}">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                        <a href="{% url 'mailing_delete' mailing.pk %}" style="color: #f44336;">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</a>

                        <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ -->
                        {% if user.groups.all.0.name == '–ú–µ–Ω–µ–¥–∂–µ—Ä—ã' or user.is_superuser %}
                            {% if mailing.owner != user %}
                                <div style="margin-top: 5px; font-size: 0.8em; color: #666;">
                                    <em>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç –∏–º–µ–Ω–∏ {{ mailing.owner.username }}</em>
                                </div>
                            {% endif %}
                        {% endif %}
                    {% else %}
                        <span style="color: #999; font-size: 0.9em;">–¢–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä</span>
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" style="text-align: center;">–†–∞—Å—Å—ã–ª–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div style="margin-top: 20px;">
        <a href="{% url 'home' %}">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a> |
        <a href="{% url 'client_list' %}">üìã –ö —Å–ø–∏—Å–∫—É –∫–ª–∏–µ–Ω—Ç–æ–≤</a> |
        <a href="{% url 'message_list' %}">üì® –ö —Å–ø–∏—Å–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π</a>
    </div>
</body>
</html>